#!/usr/bin/env ruby
require 'rubygems'
require 'broham'
require 'broham/script'
Settings.define :set, :description => %Q{Any arg prefixed with "--set" will become an extra arg to register: 'broham-register foo --set-path=/path/to/foo' sets :path => '/path/to/foo' as an additional attribute}, :type => Hash

Broham.get_cluster_settings
role_name, broham_args = [Settings[:role_name], Settings[:set]||{}]

$stderr.puts %Q{Registering as next #{role_name} with #{broham_args.inspect}}
resp = Broham.register_as_next role_name, broham_args
$stderr.puts resp.to_pretty_json

