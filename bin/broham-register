#!/usr/bin/env ruby
require 'rubygems'
require 'broham'
require 'broham/script'
Settings.define :set, :description => %Q{Any arg prefixed with "--set" will become an extra arg to register: 'broham-register foo --set-path=/path/to/foo' sets :path => '/path/to/foo' as an additional attribute}, :type => Hash

cluster = Broham.get_cluster_settings
cluster_name, role_name, broham_args = [Settings[:cluster_name], Settings[:role_name], Settings[:set]||{}]

$stderr.puts %Q{Registering as #{role_name} in #{cluster_name} cluster, with #{broham_args.inspect}}
resp = cluster.register role_name, broham_args
node = cluster.host role_name
$stderr.puts resp.to_pretty_json

